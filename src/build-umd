#!/usr/bin/env node

process.env.NODE_ENV = 'production';

const program = require('commander');
const path = require('path');
const spawn = require('cross-spawn-async');
const chalk = require('chalk');

const SRC = 'try';
const DIST = 'dist';

program.parse(process.argv);

const wcePath = path.dirname(__dirname);
const configPath = path.join(wcePath, 'webpack-config.js');
const crossEnvCmd = './node_modules/.bin/cross-env';
const webpackCmd = './node_modules/.bin/webpack';
const webpackCmdAndArgs = [webpackCmd, '--config', configPath];

process.stdout.write(chalk.gray('---umd---', '\n'));
process.stdout.write(chalk.blue('   umd:', SRC, '->', DIST, '\n'));
var webpack = spawn(crossEnvCmd, webpackCmdAndArgs);

webpack.stdout.on('data', data => process.stdout.write(data.toString()));
webpack.stderr.on('data', data => process.stdout.write(chalk.red(data.toString(), '\n')));
webpack.on('close', code => process.stdout.write(chalk.gray('---umd done---', '\n')));
